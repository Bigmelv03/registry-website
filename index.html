<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Iglesia Buenas Nuevas ‚Äì Lista de Regalos por Fases</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
:root {
  --bg: #181818;
  --card: #23283a;
  --ink: #ffffff;
  --ink2: #aac;
  --ink3: #d6eaff;
  --cyan: #6ef;
  --price: #7fa;
  --accent: #ff9100;
  --shadow: 0 1px 5px #0003;
}
body {
  background: var(--bg);
  color: var(--ink);
  font-family: 'Segoe UI', Arial, sans-serif;
  margin: 0;
  padding: 1em;
}
h1 { margin: 0 0 .6em 0; }
h2 { color: var(--cyan); margin-top: 1.7em; margin-bottom: 0.1em; }
.en { color: var(--ink2); font-size: 0.93em; margin: 0 0 0.7em 0; }

.phase-items {
  display: flex;
  flex-wrap: wrap;
  gap: 1.2em;
  margin: 2.2em 0;
  justify-content: center;
}
.item {
  width: 220px;
  background: var(--card);
  border-radius: 12px;
  padding: 0.7em 0.5em 0.9em;
  text-align: center;
  box-shadow: var(--shadow);
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.item img {
  max-width: 100%;
  max-height: 100px;
  border-radius: 6px;
  background: #111;
  margin-top: 0.6em;
  cursor: pointer;
  transition: transform 0.25s ease;
  object-fit: cover;
}
.item img:hover { transform: scale(1.03); }
.item-title {
  font-size: 1.05em;
  font-weight: 700;
  margin: 0.5em 0 0.2em;
}
.price { color: var(--price); font-weight: 700; }
.qty { font-size: 0.95em; color: #fff9; margin-bottom: 0.3em; }
.desc {
  font-size: 0.95em;
  color: var(--ink3);
  margin-bottom: 0.3em;
  white-space: pre-line;
}

/* Badges */
.badge {
  position: absolute;
  top: -8px; left: -8px; right: -8px;
  background: #ff3b3b;
  color: white;
  font-weight: bold;
  font-size: 0.9em;
  border-radius: 8px 8px 0 0;
  padding: 0.4em 0.2em;
  box-shadow: 0 0 4px #0005;
  text-shadow: 0 0 2px #000a;
}
.badge.yellow { background: #ffd93b; color: #222; text-shadow: none; }
.badge.green {
  background: #00ff80;
  color: #003300;
  animation: neonflash 1s linear infinite alternate;
  box-shadow: 0 0 6px #00ff80;
}
@keyframes neonflash {
  0% { opacity: 1; box-shadow: 0 0 4px #00ff80, 0 0 10px #00ff80; }
  100% { opacity: 0.6; box-shadow: 0 0 6px #00ff80, 0 0 14px #00ff80; }
}

/* Modal */
.modal-img-bg {
  display: none;
  position: fixed; z-index: 1000;
  left: 0; top: 0; width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.84);
  justify-content: center; align-items: center;
}
.modal-img-bg.active { display: flex; }
.modal-img-bg img {
  max-width: 94vw; max-height: 88vh;
  border-radius: 13px;
  box-shadow: 0 2px 15px #000a;
}
.modal-img-bg:after {
  content: "‚úï";
  position: absolute;
  top: 1em; right: 1.3em;
  color: #fff;
  font-size: 2.2em;
  font-weight: bold;
  cursor: pointer;
}
@media (max-width: 520px) {
  .item { width: 98vw; max-width: 99vw; }
}
</style>
</head>
<body>

<h1>Iglesia Buenas Nuevas - Registro de sistemas de sonido</h1>
<h2><span class="en" style="color:#aac;font-size:1.3em;">Good News Church - Sound System Registry</span></h2>

<!-- =========================
     TESTIMONIO DE BENDICI√ìN / BLESSING TESTIMONY
     ========================= -->
<div class="top-card" style="margin:2.2em 0 2.2em 0; border-top:4px solid #ff9100;">
  <div class="glory-flash" style="margin-top:1.0em;">¬°Toda la gloria a √âl!</div>
  <p>Dios ya ha comenzado a bendecir este proyecto...</p>
  <div class="glory-flash" style="margin-top:1.0em;">To God be the glory!</div>
  <p>God is already starting to bless us in this project...</p>
</div>

<!-- INTRO STORY -->
<div class="top-card" style="margin:2.2em 0 2.2em 0; border-top:4px solid #ff9100;">
  <h2 style="color:#ff9100; margin-top:1em;">
  El Coraz√≥n Detr√°s del Proyecto / The Heart Behind the Project
  </h2>
  <p>¬°Hola familia! Gracias por apoyar el ministerio de sonido...</p>
  <hr style="border:none; border-top:1px solid #ff9100; margin:1.2em 0;">
  <p>Hello family! Thank you for supporting our sound ministry...</p>
</div>

<!-- INSTRUCTIONS -->
<div class="note" style="margin:2.2em 0; border-top:4px solid #ff9100;">
  <h2 style="color:#ff9100; margin-top:1em;">
  ¬øC√≥mo Funciona la Lista por Fases? / How the Phase List Works
  </h2>
  <p>Hemos dividido la lista en fases...</p>
</div>

<!-- ORDERING NOTE + TOP QR -->
<div class="note" style="margin-top:2.2em; border-top:4px solid #ff9100;">
  <h2 style="color:#ff9100; margin-top:1em;">¬øC√≥mo Hacer Tu Pedido? / How to Order</h2>
  <p>Por favor, ordene solamente desde nuestro registro oficial...</p>
</div>

<div class="registry-actions">
  <div class="qr">
    <img alt="QR ‚Äì Registry" src="https://api.qrserver.com/v1/create-qr-code/?size=260x260&data=https%3A%2F%2Fwww.amazon.com%2Fregistries%2Fgl%2Fguest-view%2F1E6GZIQ5MG9GC">
    <div class="cap">Escanea para ver el registro<br><small>Scan to view the registry</small></div>
  </div>
  <div class="flash-reminder">
    <span>¬°No olvides buscar cupones de descuento antes de comprar!</span><br>
    <span style="font-size:0.98em">Don‚Äôt forget to check for coupons before you order!</span>
  </div>
  <a class="button" href="https://www.amazon.com/registries/gl/guest-view/1E6GZIQ5MG9GC" target="_blank">üõí Ordenar aqu√≠ / Order Here</a>
</div>

<!-- =========================
     FASES (1‚Äì6)
     ========================= -->
<h2>üß± Fase 1 ‚Äì Sistema de Sonido Base<br><span class="en" style="color:#aac; font-size:0.82em;">Phase 1 ‚Äì Core Sound System Infrastructure</span></h2>
<div id="phase-items-1" class="phase-items"></div>

<h2>üé§ Fase 2 ‚Äì Micr√≥fonos, Monitores y Accesorios<br><span style="color:#aac; font-size:0.82em;">Phase 2 ‚Äì Microphones, Monitors, and Accessories</span></h2>
<div id="phase-items-2" class="phase-items"></div>

<h2>üì° Fase 3 ‚Äì M√°stil de Antenas y Cables<br><span style="color:#aac; font-size:0.82em;">Phase 3 ‚Äì Antenna Mast & Cabling</span></h2>
<div id="phase-items-3" class="phase-items"></div>

<h2>üéöÔ∏è Fase 4 ‚Äì Mezcladora Avanzada<br><span style="color:#aac; font-size:0.82em;">Phase 4 ‚Äì Advanced Mixer Setup</span></h2>
<div id="phase-items-4" class="phase-items"></div>

<h2>üéß Fase 5 ‚Äì Monitoreo Personal<br><span style="color:#aac; font-size:0.82em;">Phase 5 ‚Äì Personal Monitoring System</span></h2>
<div id="phase-items-5" class="phase-items"></div>

<h2>üí° Fase 6 ‚Äì Extras y Optimizaci√≥n<br><span style="color:#aac; font-size:0.82em;">Phase 6 ‚Äì Extras & Optimization</span></h2>
<div id="phase-items-6" class="phase-items"></div>

<!-- API SCRIPT -->
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxTvUMgfiDCpxxtgXBpSaR0JxOAWcqUzXL_mvo6Q-k6Oae9GD5zUC3C9-RAZdKgYpV_yw/exec";

function enlargeImg(img) {
  const m = document.getElementById("imgModal");
  document.getElementById("modalImg").src = img.src;
  m.classList.add("active");
  m.onclick = () => m.classList.remove("active");
}

function createBadge(purchased, qty) {
  const div = document.createElement("div");
  if (!qty || isNaN(qty)) qty = 0;
  if (!purchased || isNaN(purchased)) purchased = 0;

  if (purchased >= qty && qty > 0) {
    div.className = "badge green";
    div.textContent = "Completado / Completed";
  } else if (purchased === 0) {
    div.className = "badge";
    div.textContent = `Comprado/Purchased ${purchased}/${qty}`;
  } else {
    div.className = "badge yellow";
    div.textContent = `Comprado/Purchased ${purchased}/${qty}`;
  }
  return div;
}

function cardFor(item) {
  const card = document.createElement("div");
  card.className = "item";

  const qty = parseInt(item.quantity) || 0;
  const purchased = parseInt(item.purchased) || 0;

  const badge = createBadge(purchased, qty);
  const img = document.createElement("img");
  img.src = item.image_url || "";
  img.alt = item.title_en || item.title_es || "";
  img.onclick = () => enlargeImg(img);

  const title = document.createElement("div");
  title.className = "item-title";
  title.innerHTML = `${item.title_es || ""}<br><span class='en'>${item.title_en || ""}</span>`;

  const price = document.createElement("div");
  price.className = "price";
  price.textContent = item.price ? `$${item.price}` : "";

  const qtyDiv = document.createElement("div");
  qtyDiv.className = "qty";
  qtyDiv.textContent = qty ? `Cantidad: ${qty}` : "";

  const desc = document.createElement("div");
  desc.className = "desc";
  desc.innerHTML = `${item.desc_es || ""}<br>${item.desc_en || ""}`;

  card.append(badge, img, title, price, qtyDiv, desc);
  return card;
}

async function loadPhaseItems(phase) {
  try {
    const res = await fetch(`${API_URL}?phase=${phase}`);
    const data = await res.json();
    const container = document.getElementById(`phase-items-${phase}`);
    container.innerHTML = "";

    // Filter out header rows or incomplete entries
    const validItems = (data.items || []).filter(it => {
      return (
        it &&
        !String(it.title_es).includes("Title") &&
        !String(it.price).includes("Price") &&
        it.image_url &&
        it.image_url.startsWith("http")
      );
    });

    validItems.forEach(it => container.append(cardFor(it)));
  } catch (e) {
    console.error("Error loading phase", phase, e);
  }
}

document.addEventListener("DOMContentLoaded", () => {
  for (let i = 1; i <= 6; i++) loadPhaseItems(i);
});
</script>

</body>
</html>
